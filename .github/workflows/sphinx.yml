# Github Actions workflow to generate documentation
# Uses the following shared task definitions:
# - (checkout, upload artifact) from Github
name: Sphinx build

# Controls when the action will run.
# Triggers the workflow on push or pull request events.
on:
- push
- pull_request

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false

    # Steps are a sequence of tasks that will be executed as part of the job
    steps:
    # Check out repository under $GITHUB_WORKSPACE
    - uses: actions/checkout@v3

    - name: Set up documentation build tree
      id: setup
      run: |
        ./.github/actions/sphinx/setup.sh
        echo "version=$(cat docs/_docker/docs_version.txt)" >> $GITHUB_ENV

    # Builds docs using sphinx
    - name: Build HTML docs
      uses: ./.github/actions/sphinx

    - name: Build PDF manual
      uses: ./.github/actions/sphinx
      with:
        make-target: latexpdf

    - name: Rename PDF file
      run: cp docs/_build/latex/openshot.pdf "docs/OpenShot User Guide.pdf"
        
    # Create artifacts out of the generated docs
    - uses: actions/upload-artifact@v3
      with:
        name: "OpenShot ${{ env.version }} User Guide (PDF)"
        path: "docs/OpenShot User Guide.pdf"
        
    - uses: actions/upload-artifact@v3
      with:
        name: "OpenShot ${{ env.version }} User Guide (HTML)"
        path: "docs/_build/html/"

